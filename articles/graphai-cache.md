---
title: "GraphAI Agentã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [agent, AI, LLM, Tech, GraphAI]
published: true
publication_name: "singularity"
---

:::message
GraphAIè¨˜äº‹ã®ä¸€è¦§ã¯[ã“ã¡ã‚‰](https://zenn.dev/singularity/articles/graphai-index)
:::


# è¤‡é›‘ãªãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹ç¯‰ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨: GraphAIã®å°å…¥æ–¹æ³•

GraphAIã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€LLMï¼ˆå¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼‰ã€Webã‚¢ã‚¯ã‚»ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãªã©ã€è¤‡æ•°ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ãŸé«˜åº¦ãªãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚ã—ã‹ã—ã€LLMã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã€Webãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯å‡¦ç†æ™‚é–“ã‚„ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ãŸã‚ã€åŒã˜å‡¦ç†çµæœã‚’åŠ¹ç‡çš„ã«å†åˆ©ç”¨ã™ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®æ´»ç”¨ãŒé‡è¦ã§ã™ã€‚

GraphAIã§ã¯ã€ã“ã®èª²é¡Œã«å¯¾å¿œã™ã‚‹ãŸã‚ã€**Agent Filter** ã‚’ç”¨ã„ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå˜ä½ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

---

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ†é¡

GraphAIã§ã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å…¥åŠ›å€¤ã¨å‡ºåŠ›å€¤ã®ç‰¹æ€§ã«åŸºã¥ãã€ä»¥ä¸‹ã®3ç¨®é¡ã«åˆ†é¡ã—ã¦ã„ã¾ã™ã€‚

1. **å…¥åŠ›ã«å¯¾ã—ã¦å¸¸ã«åŒã˜å‡ºåŠ›ã‚’ç”Ÿæˆã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**  
   - ä¸»ã«ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’æ‹…å½“ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
   - **ä¾‹**: è¡Œåˆ—è¨ˆç®—ã‚„é…åˆ—ã®å‡¦ç†ãªã©ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
   - **ä¾‹**: LLMï¼ˆå³å¯†ã«ã¯æ¯å›å‡ºåŠ›ãŒç•°ãªã‚‹ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§å†åˆ©ç”¨å¯èƒ½ï¼‰  
     - **æ³¨æ„**: çµæœãŒä¸é©åˆ‡ãªå ´åˆã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã€å†å®Ÿè¡Œã™ã‚‹ã€‚

2. **å†…éƒ¨çŠ¶æ…‹ã«ä¾å­˜ã—ã¦å‡ºåŠ›ãŒå¤‰åŒ–ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**  
   - **ä¾‹**: ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã‚„ä¸€æ™‚çš„ãªçŠ¶æ…‹ç®¡ç†ã‚’ä¼´ã†å‡¦ç†
   - **ä¾‹**: Webã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚TTLã‚„http headerç­‰ã§cacheã®çŠ¶æ…‹ã‚’åˆ¤å®šã™ã‚‹
3. **å¤–éƒ¨è¦å› ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«ã‚ˆã£ã¦å‹•ä½œã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**  
   - **ä¾‹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚„ç”»åƒå…¥åŠ›ã«å¿œã˜ã¦å‡¦ç†ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

---

## GraphAIã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯**Agent Filter**ã‚’é€šã˜ã¦å®Ÿç¾ã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç®¡ç†**  
  GraphAIã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æä¾›ã›ãšã€åˆ©ç”¨è€…ãŒä»»æ„ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’é¸æŠå¯èƒ½ã€‚  
  GraphAIã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ã«`getCache`ãŠã‚ˆã³`setCache`é–¢æ•°ã‚’æ¸¡ã™ã“ã¨ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å‰Šé™¤ã‚„ã‚¯ãƒªã‚¢**  
  ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ï¼ˆå‰Šé™¤ã‚„ã‚¯ãƒªã‚¢ï¼‰ã¯GraphAIã®å¤–å´ã§å®Ÿè£…ã—ã¾ã™ã€‚

---

## å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‡¦ç†ä¾‹

### 1. å…¥åŠ›ã«å¯¾ã—ã¦å¸¸ã«åŒã˜å‡ºåŠ›ã‚’ç”Ÿæˆã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- **å®Ÿè£…æ–¹æ³•**  
  Cache Agent Filterå†…ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚  
  ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãƒ’ãƒƒãƒˆã—ãŸå ´åˆã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã•ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥çµæœã‚’ç›´æ¥è¿”ã—ã¾ã™ã€‚  
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ**  
  `namedInputs`, `params`, `agentId` ã®çµ„ã¿åˆã‚ã›ã‚’JSONå½¢å¼ã§ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### 2. å†…éƒ¨çŠ¶æ…‹ã«ä¾å­˜ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- **å®Ÿè£…æ–¹æ³•**  
  Cache Agent Filterã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥é–¢æ•°ã‚’ç”¨æ„ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†…ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®èª­ã¿æ›¸ãã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ**  
  ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®è¨­è¨ˆã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå´ã§å®Ÿè£…ã—ã¾ã™ã€‚

### 3. å¤–çš„è¦å› ã«ã‚ˆã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- **å®Ÿè£…æ–¹æ³•**  
  ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚

# ä½¿ã„æ–¹

`getCache`ãŠã‚ˆã³`setCache`é–¢æ•°ã‚’å®Ÿè£…ã—ã€cacheAgentFilterGeneratorã«`getCache`ãŠã‚ˆã³`setCache`é–¢æ•°ã‚’æ¸¡ã—ã¦ã€cacheAgentFilterã‚’å–å¾—ã—ã¾ã™ã€‚

ãã®agentFilterã¯GraphAIã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã—ã¾ã™ã€‚

```typescript
const setCache = async (key: string, data: any) => {
  ...
  return;
};
const getCache = async (key: string) => {
  ...
  return data;
}

const cacheAgentFilter = cacheAgentFilterGenerator({ getCache, setCache });
```

### pureAgent

pureAgentã¯ã€AgentFunctionInfoã®`cacheType`ã«`"pureAgent"`ã‚’æŒ‡å®šã—ã¾ã™

```typescript
cacheType: "pureAgent"
```

`pureAgent`ã¯ã€å…¥åŠ›å€¤(inputsã¨paramas)ã§çµæœãŒä¸€æ„ã«æ±ºã¾ã‚‹ã®ã§ã€ãã‚Œã‚‰ã‚’keyã«ã—ã¦`agent filter`å†…ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµæœã‚’è¿”ã—ã¾ã™ã€‚
ã¤ã¾ã‚Šagentå´ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…ã¯ä¸è¦ã§ã™ã€‚

### impureAgent

impureAgentã¯ã€AgentFunctionInfoã®`cacheType`ã«`"impureAgent"`ã‚’æŒ‡å®šã—ã¾ã™

```typescript
cacheType: "impureAgent"
```

`pureAgent`ã¯ã€Agentå†…éƒ¨ã®çŠ¶æ…‹ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å‹•ä½œãŒãã¾ã‚‹ã®ã§`agent`å†…ã§ã€`agent filter`ã®`set/getCache`é–¢æ•°ã‚’ä½¿ã£ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ“ä½œã‚’ã—ã¾ã™ã€‚
cacheé–¢æ•°ãŒãªã„å ´åˆã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


```typescript
// impureAgent cache example.
const impureSampleAgent: AgentFunction = async ({ namedInputs, filterParams }) => {
  // cache process.
  const { message } = namedInputs;
  const fileKey = .....

  // get cache from cache storage
  if (filterParams.cache) {
    const cacheData = await filterParams.cache.getCache(fileKey);
    if (cacheData) {
      return cacheData;
    }
  }

  // agent process.
  ...
  ...
  ...
  const result = ...

  // after cache process
  if (filterParams.cache) {
    await filterParams.cache.setCache(fileKey, result);
  }
  return result;
};
```

è©³ã—ãã¯ã€agent_filterã®testã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
agent_filters/tests/filters/test_cache_impure.ts

sqlliteã‚’ä½¿ã£ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã“ã¡ã‚‰

https://github.com/receptron/graphai/blob/main/packages/samples/src/cache/cache_example.ts